<div class="page-container py-8 space-y-6">
  <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
    <div>
      <h1 class="text-3xl font-bold">관리자 대시보드</h1>
      <p class="text-sm text-base-content/70">미응답 주문과 입금 대기 현황을 빠르게 확인합니다.</p>
    </div>
    <div class="flex flex-wrap gap-2">
      <%= link_to "주문 관리", admin_orders_path, class: "btn btn-primary btn-sm" %>
      <%= link_to "입금 대기", admin_payments_path, class: "btn btn-ghost btn-sm" %>
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
    <div class="card bg-base-100 shadow-lg">
      <div class="card-body">
        <p class="text-sm text-base-content/70">오늘 주문 수</p>
        <p class="text-3xl font-bold"><%= @stats[:orders_today] %>건</p>
      </div>
    </div>
    <div class="card bg-base-100 shadow-lg">
      <div class="card-body">
        <p class="text-sm text-base-content/70">오늘 주문 금액</p>
        <p class="text-3xl font-bold">
          <%= number_to_currency(@stats[:amount_today] / 100.0, unit: "", precision: 0) %>원
        </p>
      </div>
    </div>
    <div class="card bg-base-100 shadow-lg">
      <div class="card-body">
        <p class="text-sm text-base-content/70">오늘 완료 건수</p>
        <p class="text-3xl font-bold"><%= @stats[:completed_today] %>건</p>
      </div>
    </div>
    <div class="card bg-base-100 shadow-lg">
      <div class="card-body">
        <p class="text-sm text-base-content/70">입금 대기</p>
        <p class="text-3xl font-bold"><%= @stats[:payment_pending_count] %>건</p>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <section class="card bg-base-100 shadow-lg">
      <div class="card-body">
        <div class="flex items-center justify-between">
          <div>
            <h2 class="text-lg font-semibold">미응답 주문</h2>
            <p class="text-sm text-base-content/70">농가 검토 중이며 2시간 내 만료 대상</p>
          </div>
          <div class="badge badge-warning"><%= @stats[:farmer_review_count] %>건</div>
        </div>

        <% if @farmer_review_orders.empty? %>
          <div class="py-6 text-sm text-base-content/70">임박한 미응답 주문이 없습니다.</div>
        <% else %>
          <div class="overflow-x-auto">
            <table class="table">
              <thead>
                <tr>
                  <th>주문번호</th>
                  <th>농가</th>
                  <th>고객</th>
                  <th>타임아웃</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <% @farmer_review_orders.each do |order| %>
                  <% timed_out = order.timeout_at.present? && order.timeout_at <= Time.current %>
                  <tr class="<%= timed_out ? 'bg-error/10' : '' %>">
                    <td class="font-mono text-xs"><%= order.order_number %></td>
                    <td><%= order.farmer&.business_name %></td>
                    <td><%= order.user&.name %></td>
                    <td><%= order.timeout_at ? l(order.timeout_at, format: :short) : "-" %></td>
                    <td class="text-right">
                      <%= link_to "보기", admin_order_path(order), class: "btn btn-ghost btn-xs" %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        <% end %>
      </div>
    </section>

    <section class="card bg-base-100 shadow-lg">
      <div class="card-body">
        <div class="flex items-center justify-between">
          <div>
            <h2 class="text-lg font-semibold">입금 대기</h2>
            <p class="text-sm text-base-content/70">입금 확인이 필요한 주문</p>
          </div>
          <div class="badge badge-info"><%= @stats[:payment_pending_count] %>건</div>
        </div>

        <% if @payment_pending_orders.empty? %>
          <div class="py-6 text-sm text-base-content/70">입금 대기 주문이 없습니다.</div>
        <% else %>
          <div class="overflow-x-auto">
            <table class="table">
              <thead>
                <tr>
                  <th>주문번호</th>
                  <th>농가</th>
                  <th>고객</th>
                  <th>금액</th>
                  <th>요청일</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <% @payment_pending_orders.each do |order| %>
                  <tr>
                    <td class="font-mono text-xs"><%= order.order_number %></td>
                    <td><%= order.farmer&.business_name %></td>
                    <td><%= order.user&.name %></td>
                    <td><%= number_to_currency(order.total_amount / 100.0, unit: "", precision: 0) %>원</td>
                    <td><%= l(order.created_at, format: :short) %></td>
                    <td class="text-right">
                      <%= link_to "보기", admin_order_path(order), class: "btn btn-ghost btn-xs" %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        <% end %>
      </div>
    </section>
  </div>
</div>
