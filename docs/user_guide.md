# 사용자 가이드

## 개요
농산물 직거래 플랫폼 사용 가이드입니다. 소비자, 농가, 관리자별 주요 기능을 안내합니다.

---

## 1. 소비자 가이드

### 1.1 회원가입 및 로그인
1. **회원가입**
   - 이메일 또는 카카오/네이버 소셜 로그인 지원
   - 필수 정보: 이름, 이메일, 연락처

2. **로그인**
   - 이메일 + 비밀번호
   - 또는 카카오/네이버 간편 로그인

### 1.2 상품 둘러보기
1. **홈 페이지**
   - 농가별 상품 목록 확인
   - 재고 상태 실시간 표시 (⭕ 판매중 / ❌ 품절)

2. **상품 상세**
   - 상품 정보, 가격, 재고 수량 확인
   - 수량 선택 (1 ~ 재고 수량)
   - "장바구니 담기" 버튼 클릭

### 1.3 장바구니
1. **장바구니 확인**
   - 헤더의 장바구니 아이콘 클릭
   - 농가별로 상품이 그룹핑되어 표시됨

2. **수량 변경**
   - 각 상품의 수량을 직접 수정 가능
   - 소계가 실시간으로 업데이트됨

3. **삭제**
   - "삭제" 버튼으로 개별 상품 제거
   - "장바구니 비우기"로 전체 삭제

4. **주문하기**
   - **중요**: 농가별로 별도 주문이 생성됩니다
   - 각 농가 섹션마다 "○○농가 상품 주문하기" 버튼
   - 예: A농가, B농가 상품이 있으면 2개의 주문 생성

### 1.4 주문 생성
1. **주문서 작성**
   - 받는 분 이름, 연락처 입력
   - 배송 주소 입력 (우편번호, 상세주소)
   - 배송 메모 입력 (선택사항)

2. **주문 확인**
   - 주문 항목, 총액 확인
   - 농가 계좌 정보 확인 (뒤 4자리 마스킹)
   - "주문하기" 버튼 클릭

3. **주문 완료**
   - 주문 번호 발급
   - 입금 안내 확인
   - "내 주문 보기"로 주문 상세 이동

### 1.5 주문 관리
1. **주문 목록**
   - "내 주문" 메뉴에서 모든 주문 확인
   - 상태별 필터 (전체/검토중/확정/입금대기/완료/취소)
   - 최신순 정렬

2. **주문 상세**
   - 주문 상태 타임라인 확인
   - 주문 항목, 배송지 정보 확인
   - 농가 계좌 정보 (마스킹)
     - "전체 보기" 버튼으로 전체 계좌번호 확인 가능

3. **입금 완료 신고**
   - 농가 계좌로 입금 완료 후
   - 주문 상세에서 "입금 완료" 버튼 클릭
   - 상태: confirmed → payment_pending

4. **주문 취소**
   - 농가 승인 전 (pending, farmer_review)에만 가능
   - "주문 취소" 버튼 클릭
   - 확인 모달에서 "확인" 클릭

### 1.6 주문 상태 안내
- **pending**: 주문 생성됨, 농가 검토 대기
- **farmer_review**: 농가 검토 중 (24시간 내 응답 필요)
- **confirmed**: 농가 승인됨, 입금 대기
- **payment_pending**: 입금 완료 신고됨, 관리자 확인 대기
- **completed**: 입금 확인 완료, 배송 예정
- **cancelled**: 주문 취소됨

---

## 2. 농가 가이드 (타입 A: 수동 승인)

### 2.1 알림톡 링크
1. **알림 수신**
   - 주문 발생 시 카카오 알림톡 또는 SMS 수신
   - 링크 클릭하여 승인 페이지 접속

2. **토큰 유효 시간**
   - **30분** 이내에 승인/거절 필요
   - 만료 시 관리자에게 연락 또는 재발송 요청

### 2.2 주문 승인/거절
1. **주문 확인**
   - 주문 항목, 총액, 주문자 정보 확인
   - 재고 상태 확인

2. **승인**
   - "승인" 버튼 클릭
   - 확인 모달에서 "확인"
   - 재고 자동 차감
   - 소비자에게 승인 알림 발송

3. **거절**
   - "거절" 버튼 클릭
   - 거절 사유 입력 (선택사항)
   - 소비자에게 거절 알림 발송

### 2.3 주의사항
- 링크는 1회만 사용 가능 (재사용 불가)
- 만료되거나 이미 처리된 링크는 가드 페이지 표시
- 문제 발생 시 관리자(구청 담당자)에게 연락

---

## 3. 농가 가이드 (타입 B: 자동 승인)

### 3.1 자동 승인 프로세스
1. **주문 발생**
   - 재고가 충분하면 자동으로 승인 (confirmed)
   - 재고 자동 차감

2. **재고 소진**
   - 재고가 0이 되면 자동으로 판매 중지
   - 알림톡/SMS로 재고 소진 알림

### 3.2 일간 요약
- 매일 오후 6시에 일간 주문 요약 SMS 수신
- 당일 주문 건수, 총 금액 확인

### 3.3 재고 관리
- 재고 수정은 관리자(구청 담당자)에게 요청
- 또는 추후 농가 전용 관리 페이지 제공 예정

---

## 4. 관리자 가이드

### 4.1 대시보드
1. **미응답 주문**
   - farmer_review 상태이고 타임아웃 임박 (2시간 이내)
   - 타임아웃 경과 주문은 빨간색 강조

2. **입금 대기**
   - payment_pending 상태 주문 목록
   - 빠른 확인 필요

3. **오늘의 통계**
   - 오늘 주문 건수/금액
   - 완료 건수
   - 입금 대기 건수

### 4.2 주문 관리
1. **주문 목록**
   - 미응답 주문 / 입금 대기 탭 전환
   - 타임아웃 임박 필터
   - 타임아웃 경과 건수 표시

2. **주문 상세**
   - 주문 정보, 배송지, 상품 목록 확인
   - 관리자 메모 실시간 자동 저장

3. **대리 승인/취소**
   - farmer_review 상태에서 대리 승인/취소 가능
   - 대리 처리 시 소비자에게 알림 발송

4. **입금 확인**
   - payment_pending 상태에서 입금 확인
   - 확인 수단 선택 (전화/문자)
   - 관리자 메모 입력 (예: "1/15 전화 확인")
   - 확인 완료 시 상태 → completed

5. **CSV 다운로드**
   - 현재 필터 조건 기준으로 주문 목록 다운로드
   - 엑셀로 열어서 분석 가능

### 4.3 농가 관리
1. **농가 목록**
   - 전체 농가 정보 확인
   - 상호, 대표자, 연락처, 재고, 승인 방식 등

2. **농가 수정**
   - 기본 정보 수정
   - 계좌 정보 수정 (암호화 저장)
   - 승인 방식 변경 (manual/auto)
   - 알림 방식 변경 (kakao/sms)

3. **계좌 정보 보안**
   - 목록에서는 뒤 4자리만 표시
   - "전체 보기" 클릭 시 모달로 전체 계좌번호 확인

### 4.4 상품 관리
1. **상품 목록**
   - 전체 상품 목록 확인
   - 농가별, 재고별 확인

2. **상품 수정**
   - 상품 정보 수정 (이름, 가격, 설명 등)
   - 재고 수정 (수량, 상태)
   - 판매 여부 토글

3. **재고 수정** (목록에서 직접 수정 가능)
   - 수량 입력
   - 상태 선택 (available/out_of_stock)
   - "저장" 버튼 클릭

### 4.5 보안
1. **관리자 인증**
   - 주 1회 SMS OTP 재인증 (구현 예정)
   - 행사 기간 중 매번 재인증 (선택사항)

2. **계좌 정보 보호**
   - 암호화 저장 (Active Record encrypts)
   - 화면/알림에는 뒤 4자리만 표시
   - 전체 계좌는 인증 후 모달에서만 표시

---

## 5. 문제 해결

### 5.1 일반적인 문제
**Q. 장바구니에 담은 상품이 사라졌어요.**
- A. 로그인 상태를 확인하세요. 비로그인 시 장바구니는 세션에만 저장됩니다.

**Q. 주문을 취소하고 싶어요.**
- A. 주문 상세에서 "주문 취소" 버튼을 클릭하세요. 단, 농가 승인 이후에는 관리자에게 연락해주세요.

**Q. 입금했는데 주문이 완료되지 않아요.**
- A. 주문 상세에서 "입금 완료" 버튼을 클릭하세요. 관리자 확인 후 상태가 "완료"로 변경됩니다.

### 5.2 농가 문제
**Q. 승인 링크가 만료되었어요.**
- A. 관리자(구청 담당자)에게 연락하여 재발송을 요청하세요.

**Q. 링크를 클릭했는데 "이미 처리된 링크"라고 나와요.**
- A. 이미 승인/거절한 주문입니다. 중복 처리가 필요한 경우 관리자에게 연락하세요.

### 5.3 관리자 문제
**Q. 타임아웃 경과 주문은 어떻게 처리하나요?**
- A. 대리 승인/취소로 처리하거나, 자동 취소를 기다리세요 (24시간 후 자동 취소).

**Q. 입금 확인을 잘못했어요.**
- A. 주문 상세의 관리자 메모에 기록하고, 필요 시 소비자에게 연락하세요.

---

## 6. 연락처

### 지원 시간
- 평일: 09:00 - 18:00
- 주말/공휴일: 미지원

### 문의 방법
- 전화: [전화번호]
- 이메일: [이메일]
- 담당자: [담당자명]

---

## 부록: 용어 설명

- **타임아웃**: 농가 응답 기한 (24시간)
- **토큰**: 농가 승인 링크에 포함된 1회용 인증 정보
- **대리 처리**: 관리자가 농가 대신 주문 승인/거절
- **마스킹**: 보안을 위해 계좌번호 일부를 숨김 (예: ****1234)
