# 강남구 설맞이 직거래 장터 온라인 시스템 PRD

## 📋 문서 정보
- **프로젝트명**: 강남구 설맞이 직거래 장터 온라인 주문 시스템
- **문서 버전**: 1.0
- **작성일**: 2025년 11월
- **기술 스택**: Ruby on Rails
- **대상 사용자**: 강남구 주민(소비자), 농가(판매자), 구청 관리자

---

## 1. 프로젝트 개요

### 1.1 배경 및 목적

**현재 문제점**
- 전화 주문 방식으로 인한 농가-소비자 간 연결 실패
- 비체계적인 주문 관리로 인한 운영 비효율
- 고령 농가의 디지털 접근성 한계

**프로젝트 목표**
- 온라인 사전 주문 시스템으로 주문 프로세스 간소화
- 농가의 디지털 리터러시를 고려한 하이브리드 주문 관리 시스템 구축
- 구청의 효율적인 중개 역할 지원

### 1.2 핵심 가치 제안

- **소비자**: 24시간 편리한 주문, 전화 통화 불필요
- **농가**: 간단한 주문 확인 및 승인, 집중된 주문 관리
- **구청**: 체계적인 행사 운영, 데이터 기반 의사결정

---

## 2. 사용자 페르소나

### 2.1 소비자 (강남구 주민)
- **연령대**: 30-60대
- **디지털 친숙도**: 중~상
- **니즈**: 간편한 온라인 주문, 신뢰할 수 있는 직거래

### 2.2 농가 (판매자)
**타입 A: 주요 농가 (10개, 전체 주문의 80%)**
- **연령대**: 50-70대
- **디지털 친숙도**: 하~중
- **니즈**: 최소한의 조작으로 주문 확인 및 승인

**타입 B: 일반 농가 (70개, 전체 주문의 20%)**
- **연령대**: 60-80대
- **디지털 친숙도**: 하
- **니즈**: 디지털 부담 최소화, 구청 지원

### 2.3 구청 관리자
- **역할**: 시스템 관리, 농가 지원, 분쟁 조정
- **니즈**: 전체 주문 모니터링, 농가 대리 처리 권한

---

## 3. 핵심 기능 요구사항

### 3.1 소비자 기능

#### 3.1.1 회원 가입 및 로그인
- **필수 정보**: 이름, 휴대폰 번호, 주소(강남구 내 인증할 필요 없음)
- **간편 로그인**: 카카오/네이버 OAuth 지원
- **강남구 주민 인증**: 주소 입력 기반 간단 인증

#### 3.1.2 상품 조회 및 주문
```
기능 상세:
- 농가별, 카테고리별 상품 브라우징
- 상품 상세 정보: 농가 소개, 상품 설명, 가격, 예상 재고 상태
- 장바구니 기능
- 주문 시 배송지 입력
- 주문 완료 → "농가 확인 대기" 상태 표시
```

**재고 표시 방식**
- ⭕ 주문 가능 (여유)
- ⚠️ 주문 가능 (소량)
- ❌ 일시 품절
- 💬 농가 문의 필요 (재고 미확정)

#### 3.1.3 주문 관리
```
주문 상태 플로우:
1. 주문 접수 → 2. 농가 확인 중 → 3. 주문 확정 (입금 대기) 
→ 4. 입금 완료 → 5. 배송/픽업 준비 → 6. 완료

또는

1. 주문 접수 → 2. 농가 확인 중 → 3. 주문 취소 (재고 부족 등)
```

**마이페이지 기능**
- 주문 내역 조회
- 주문 상태별 필터링
- 입금 정보 확인 (농가 계좌 정보)
- 주문 취소 요청 (농가 확인 전만 가능)

#### 3.1.4 알림 시스템
- 주문 확정 시: SMS/카카오톡 알림 (농가 계좌 정보 포함)
- 주문 취소 시: 사유와 함께 알림
- 입금 마감 임박 알림

---

### 3.2 농가 기능 (하이브리드 접근)

#### 3.2.1 타입 A 농가 (주요 10개) - 디지털 컨펌 방식

**옵션 1: 카카오톡 알림톡 + 간편 링크**
```
시나리오:
1. 새 주문 발생 → 농가에게 카카오톡 알림 발송
2. 알림 내용: "○○님, 새 주문 3건이 들어왔습니다"
3. [주문 확인하기] 버튼 클릭
4. 별도 로그인 없이 주문 목록 페이지 접속 (토큰 기반 일회용 링크)
5. 간단한 UI: 주문 목록 + [전체 승인] [개별 승인/거절] 버튼
```

**옵션 2: 모바일 웹 간소화 페이지**
```
기능:
- 로그인: 휴대폰 번호 + 간단한 PIN (또는 SMS 인증)
- 메인 화면: 오늘의 주문 건수, 총 금액
- [전체 승인] [개별 확인] 버튼
- 개별 확인 시: 스와이프로 승인/거절
```

**추천 방식: 옵션 1 + 옵션 2 결합**
- 1차: 카카오톡 알림톡으로 푸시
- 2차: 링크 클릭 시 간소화된 모바일 웹으로 연결
- 백업: 12시간 미응답 시 SMS + 구청 전화 안내

#### 3.2.2 타입 B 농가 (일반 70개) - 자동/구청 지원 방식

**기본 정책: 자동 승인 + 재고 기반 제한**
```
운영 방식:
1. 사전 재고 등록 (구청이 대행 가능)
2. 재고 범위 내 주문 자동 승인
3. 재고 초과 시 주문 차단
4. 매일 아침 요약 SMS 발송: "어제 주문 5건 자동 승인되었습니다"
```

**구청 개입 조건**
- 긴급 재고 변동 요청
- 대량 주문 건 (설정 금액 이상)
- 특이 사항 발생 시

#### 3.2.3 농가 관리자 페이지 (선택적)

**간소화된 대시보드**
- 오늘의 주문 현황
- 전체 승인 / 전체 거절 버튼
- 개별 주문 상세 (고객명, 상품, 수량, 금액)
- 재고 수정 기능
- 계좌 정보 관리

**접근성 고려**
- 큰 글씨, 명확한 버튼
- 최소한의 메뉴 구조
- 튜토리얼 영상 제공

---

### 3.3 구청 관리자 기능

#### 3.3.1 농가 관리
- 농가 등록 및 정보 관리
- 상품 등록 대행
- 재고 초기 설정 및 수정
- 농가 계좌 정보 관리

#### 3.3.2 주문 모니터링
```
대시보드:
- 실시간 주문 현황 (총 주문 건수, 금액)
- 농가별 주문 현황
- 미확인 주문 건수 (알림)
- 주문 상태별 통계
```

#### 3.3.3 대리 처리 권한
- 농가 미응답 시 대리 승인/거절
- 긴급 재고 조정
- 고객 문의 대응

#### 3.3.4 데이터 분석
- 농가별 판매 실적
- 인기 상품 분석
- 주문 시간대 분석
- 엑셀 다운로드 기능

---

## 4. 시스템 아키텍처

### 4.1 기술 스택

**Backend**
- ruby 3.2.3
- Rails 8.0.4
- PostgreSQL (데이터베이스)
- Redis (캐시, 세션, 작업 큐)
- Sidekiq (백그라운드 작업)

**Frontend**
- Hotwire (Turbo + Stimulus)
- Tailwind CSS (반응형 디자인)
- ViewComponent (컴포넌트 기반 UI)

**인프라**
- AWS EC2 / Elastic Beanstalk
- AWS RDS (PostgreSQL)
- AWS S3 (이미지 저장)
- AWS SES (이메일 발송)

**외부 API**
- 카카오 알림톡 API
- SMS 발송 API (알리고, 카카오 등)
- 카카오/네이버 OAuth

### 4.2 데이터 모델 (ERD 개요)

```
주요 테이블:

Users (소비자)
- id, name, phone, address, email, oauth_provider

Farmers (농가)
- id, business_name, owner_name, phone, account_info
- farmer_type (A: 주요, B: 일반)
- notification_method (kakao, sms, auto)

Products (상품)
- id, farmer_id, name, description, price, category
- stock_quantity, stock_status

Orders (주문)
- id, user_id, total_amount, status, order_number
- confirmed_at, paid_at, completed_at

OrderItems (주문 상세)
- id, order_id, product_id, quantity, price

Notifications (알림 로그)
- id, farmer_id, order_id, type, sent_at, status

AdminActions (관리자 액션 로그)
- id, admin_id, action_type, target_type, target_id
```

### 4.3 주문 상태 머신

```ruby
# Order 모델의 상태 관리 (AASM 또는 state_machines gem 사용)

states:
  - pending          # 주문 접수
  - farmer_review    # 농가 확인 중
  - confirmed        # 주문 확정 (입금 대기)
  - payment_confirmed # 입금 확인됨
  - preparing        # 배송/픽업 준비 중
  - completed        # 완료
  - cancelled        # 취소
  - rejected         # 농가 거절

transitions:
  pending → farmer_review (자동)
  farmer_review → confirmed (농가 승인)
  farmer_review → rejected (농가 거절)
  confirmed → payment_confirmed (입금 확인)
  payment_confirmed → preparing
  preparing → completed
  pending/farmer_review → cancelled (고객 취소)
```

---

## 5. 핵심 워크플로우

### 5.1 소비자 주문 플로우

```
1. 회원가입/로그인
   ↓
2. 상품 검색 및 장바구니 담기
   ↓
3. 주문서 작성 (배송지, 연락처 확인)
   ↓
4. 주문 완료 → 상태: "농가 확인 중"
   ↓
5. 농가 승인 알림 수신 (SMS/카카오톡)
   - 계좌 정보 표시
   - 입금 기한 안내 (예: 48시간)
   ↓
6. 고객이 농가 계좌로 직접 입금
   ↓
7. 입금 후 마이페이지에서 "입금 완료" 버튼 클릭
   또는 구청/농가가 입금 확인 후 상태 변경
   ↓
8. 배송/픽업 준비 → 완료
```

### 5.2 농가 주문 확인 플로우 (타입 A)

```
1. 새 주문 발생
   ↓
2. 즉시 카카오톡 알림 발송
   "○○농가님, 새 주문 3건 (총 150,000원)"
   [주문 확인하기] 버튼
   ↓
3. 버튼 클릭 → 토큰 기반 인증 없이 주문 페이지 접속
   ↓
4. 주문 목록 확인
   - 상품별 수량, 고객 정보
   - 현재 재고 상태 표시
   ↓
5. 승인/거절 선택
   - [전체 승인] 버튼
   - 개별 [승인] [거절] 버튼
   ↓
6. 승인 시:
   - 고객에게 입금 안내 알림 자동 발송
   - 주문 상태 "주문 확정"으로 변경
   
   거절 시:
   - 거절 사유 선택 (재고 부족, 배송 불가 등)
   - 고객에게 취소 알림 발송
```

**타임아웃 정책**
- 알림 발송 후 12시간 미응답 시
  → 2차 SMS 발송
- 24시간 미응답 시
  → 구청에 알림 + 구청 직접 연락
- 48시간 미응답 시
  → 구청이 대리 처리 또는 자동 취소

### 5.3 농가 주문 확인 플로우 (타입 B)

```
1. 새 주문 발생
   ↓
2. 재고 자동 체크
   ↓
3. 재고 충분 시:
   - 자동 승인
   - 고객에게 입금 안내 발송
   - 농가에게 요약 SMS 발송 (1일 1회)
     "오늘 주문 5건 자동 승인 (총 200,000원)"
   ↓
4. 재고 부족 시:
   - 주문 자동 대기
   - 구청에 알림
   - 구청이 농가 연락 후 처리
```

### 5.4 입금 확인 플로우

```
방식 1: 농가 직접 확인
- 농가가 관리자 페이지에서 입금 확인 체크
- 자동으로 상태 변경

방식 2: 구청 일괄 확인 (권장)
- 구청이 농가 계좌 입금 내역 취합
- 주문 번호 매칭하여 일괄 처리
```

---

## 6. 비기능적 요구사항

### 6.1 성능
- 페이지 로드 시간: 2초 이내
- 동시 접속자: 최소 500명 처리 가능
- 주문 몰림 시간대 대비 (설 2주 전)

### 6.2 보안
- HTTPS 필수
- 개인정보 암호화 저장
- 농가 계좌 정보 마스킹 (주문 확정 전)
- CSRF, XSS 방어

### 6.3 접근성
- 모바일 우선 반응형 디자인
- 고령층 고려 UI/UX
  - 최소 16px 이상 글꼴
  - 명확한 색상 대비
  - 큰 터치 영역 (최소 44x44px)

### 6.4 가용성
- 99% 이상 업타임
- 일일 자동 백업
- 장애 발생 시 1시간 내 복구

---

## 7. 주요 화면 설계 (Wireframe 개요)

### 7.1 소비자 화면

#### 메인 페이지
```
[강남구 설맞이 직거래 장터 로고]

🔍 검색바

[카테고리 탭]
전체 | 과일 | 채소 | 건어물 | 한과 | 축산물

[농가 카드 리스트]
┌─────────────────────┐
│ [농가 이미지]        │
│ ○○농장              │
│ 유기농 사과 세트     │
│ 30,000원            │
│ ⭕ 주문 가능         │
└─────────────────────┘
```

#### 상품 상세 페이지
```
[상품 이미지 슬라이더]

🏠 ○○농장
📞 농가 소개

[상품명] 유기농 사과 혼합 세트 (10kg)
[가격] 45,000원
[재고] ⭕ 주문 가능

[수량 선택] - 1 +

[장바구니 담기] [바로 주문]

[상품 설명]
- 경북 청송에서 직접 재배
- 당도 15브릭스 이상
...
```

#### 마이페이지
```
👤 홍길동님

[주문 현황]
┌─────────────────────┐
│ 농가 확인 중    2건  │
│ 입금 대기       1건  │
│ 배송 준비 중    3건  │
└─────────────────────┘

[최근 주문 내역]
📦 주문번호: 2025010712345
○○농장 - 사과 세트
상태: 입금 대기 ⏰
[입금 정보 확인] [입금 완료 신고]
```

### 7.2 농가 화면 (타입 A - 모바일 웹)

#### 주문 확인 페이지
```
🌾 ○○농장 주문 확인

오늘 새 주문: 5건
총 주문 금액: 225,000원

[전체 승인하기]

━━━━━━━━━━━━━━━━━━

📦 주문 #20250107-001
고객: 김*동 (010-****-5678)
배송지: 강남구 논현동...

• 유기농 사과 세트 x 2개
  (45,000원 x 2 = 90,000원)

[승인] [거절]

━━━━━━━━━━━━━━━━━━

📦 주문 #20250107-002
...
```

### 7.3 구청 관리자 화면

#### 대시보드
```
[강남구 설맞이 직거래 장터 관리자]

📊 실시간 현황 (2025.01.15)
┌─────────────────────┐
│ 총 주문 건수: 127건  │
│ 총 주문 금액: 5,450천원│
│ 미확인 주문: 8건 ⚠️  │
│ 입금 대기: 34건      │
└─────────────────────┘

[농가별 현황]
○○농장: 23건 / 확인 완료
△△농가: 5건 / 미확인 ⚠️ [대리 처리]
...

[주문 관리] [농가 관리] [상품 관리] [통계]
```

---

## 8. 개발 우선순위 및 일정

### Phase 1: MVP (4주)
**Week 1-2: 기본 구조**
- Rails 프로젝트 셋업
- 사용자/농가/관리자 인증 시스템
- 기본 데이터 모델 구축

**Week 3-4: 핵심 기능**
- 상품 등록 및 조회
- 주문 생성 및 상태 관리
- 간단한 알림 시스템 (SMS)

### Phase 2: 고도화 (3주)
**Week 5-6: 농가 인터페이스**
- 카카오톡 알림톡 연동
- 토큰 기반 주문 확인 페이지
- 농가 타입별 자동/수동 처리 로직

**Week 7: 관리자 기능**
- 대시보드 구축
- 대리 처리 권한
- 통계 및 리포팅

### Phase 3: 테스트 및 론칭 (2주)
**Week 8: 테스트**
- 농가 대상 베타 테스트
- 시나리오 기반 통합 테스트
- 부하 테스트

**Week 9: 론칭 준비**
- 농가 교육 자료 제작
- 시스템 최종 점검
- 모니터링 체계 구축

---

## 9. 리스크 및 대응 방안

### 9.1 농가 미응답 리스크

**리스크**
- 농가가 알림을 확인하지 못하거나 응답하지 않음

**대응 방안**
1. 다중 알림 채널 (카카오톡 → SMS → 전화)
2. 타임아웃 정책 명확화 (12시간 → 24시간 → 48시간)
3. 구청 백업 인력 상시 대기
4. 자동 승인 정책 (타입 B 농가)
5. 사전 재고 충분히 확보 및 보수적 설정

### 9.2 주문 폭주 리스크

**리스크**
- 특정 시간대/상품에 주문 집중

**대응 방안**
1. 일일 주문 한도 설정 (농가별/상품별)
2. 대기열 시스템 (인기 상품)
3. 사전 예약 기간 분산 (1차: VIP, 2차: 일반)
4. 서버 스케일링 자동화

### 9.3 입금 확인 지연 리스크

**리스크**
- 입금 확인이 지연되어 배송이 늦어짐

**대응 방안**
1. 고객 자체 입금 신고 기능
2. 구청이 주기적으로 일괄 확인 (1일 2회)
3. 입금 기한 명확화 및 알림
4. 미입금 자동 취소 정책

### 9.4 시스템 장애 리스크

**리스크**
- 서버 다운, 외부 API 장애

**대응 방안**
1. 헬스 체크 및 자동 알림
2. 주요 데이터 일일 백업
3. 장애 발생 시 긴급 공지 (SMS, 카카오톡)
4. 전화 주문 백업 채널 운영 (구청)

---

## 10. 성공 지표 (KPI)

### 10.1 정량적 지표
- **주문 전환율**: 방문자 대비 주문 완료율 > 15%
- **농가 응답률**: 24시간 내 응답률 > 90%
- **주문 완료율**: 주문 접수 대비 완료율 > 85%
- **시스템 가동률**: > 99%
- **평균 주문 처리 시간**: < 48시간

### 10.2 정성적 지표
- 소비자 만족도 조사: > 4.0/5.0
- 농가 만족도 조사: > 3.5/5.0
- 구청 운영 효율성 개선 체감

### 10.3 비즈니스 지표
- 총 거래액 목표 달성
- 전년 대비 참여 농가 증가율
- 전년 대비 주문 건수 증가율

---

## 11. 운영 계획

### 11.1 고객 지원
- **FAQ 페이지**: 자주 묻는 질문
- **채팅 상담**: 구청 근무 시간 내 (09:00-18:00)
- **전화 상담**: 긴급 문의 대응
- **이메일 문의**: 비긴급 사항

### 11.2 농가 지원
- **사전 교육**: 오리엔테이션 및 매뉴얼 제공
- **튜토리얼 영상**: 주문 확인 방법 동영상
- **1:1 지원**: 구청 담당자 직통 연락처
- **정기 모니터링**: 주간 단위 농가별 체크

### 11.3 시스템 모니터링
- **일일 체크리스트**
  - 미처리 주문 확인
  - 시스템 에러 로그 점검
  - 알림 발송 실패 건 확인
  
- **주간 리포트**
  - 주요 지표 요약
  - 이슈 및 개선사항
  
- **시즌 후 분석**
  - 전체 데이터 분석
  - 차년도 개선 방향 도출

---

## 12. 향후 확장 가능성

### 12.1 단기 (차년도)
- 결제 시스템 통합 (PG사 연동)
- 고객 리뷰 및 평점 시스템
- 농가 정산 자동화
- 모바일 앱 출시

### 12.2 중기 (2-3년)
- AI 기반 수요 예측 및 재고 추천
- 정기 구독 서비스
- 타 지자체 확장
- 라이브 커머스 연동

### 12.3 장기 (3년 이상)
- 통합 유통 플랫폼
- 블록체인 기반 이력 추적
- 농가 직접 물류 네트워크

---

## 13. 부록

### 13.1 용어 정의
- **타입 A 농가**: 주문이 집중되는 상위 10개 농가, 디지털 컨펌 대상
- **타입 B 농가**: 일반 70개 농가, 자동 승인 또는 구청 지원 대상
- **토큰 기반 링크**: 로그인 없이 일회성 접근 가능한 보안 링크
- **하이브리드 접근**: 디지털과 아날로그 방식을 결합한 운영 전략

### 13.2 참고 자료
- Ruby on Rails 공식 문서: https://guides.rubyonrails.org/
- 카카오 알림톡 API: https://developers.kakao.com/
- Tailwind CSS: https://tailwindcss.com/
- Hotwire: https://hotwired.dev/

### 13.3 연락처
- **프로젝트 책임자**: [강남구청 담당 부서]
- **기술 리드**: [개발팀 연락처]
- **디자인 리드**: [디자인팀 연락처]

---

## 문서 개정 이력
| 버전 | 날짜 | 작성자 | 변경 내용 |
|------|------|--------|-----------|
| 1.0  | 2025.11 | AI Assistant | 초안 작성 |

---

이 PRD는 강남구 설맞이 직거래 장터의 특수한 상황(고령 농가, 디지털 격차)을 고려하여 **실용적이고 실현 가능한 하이브리드 접근 방식**을 제안합니다. 

핵심은:
1. **타입별 차별화 전략** - 주요 농가와 일반 농가를 다르게 관리
2. **다중 알림 채널** - 카카오톡 → SMS → 전화 → 구청 개입
3. **간소화된 UI** - 농가가 최소한의 조작으로 주문 처리
4. **구청의 안전망** - 미응답 시 대리 처리 권한
5. **단순한 결제** - 직접 계좌이체로 시스템 부담 최소화

